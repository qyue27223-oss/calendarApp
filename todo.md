# 日历应用扩展功能开发 TODO

## ✅ 已完成功能

### 1. 代码结构优化（已完成）
- ✅ **MainActivity.kt 大幅优化**：
  - 从 1514 行优化到 780 行，减少约 734 行代码（48.5%）
  - 提取了 5 个对话框组件到独立文件 `ImportExportDialogs.kt`（768 行）
  - 删除了冗余的 `syncSubscriptionsOnStartup` 函数
  - 将 `getWeekNumber` 函数移至 `util/TimeExtensions.kt` 作为扩展函数
  - 清理了所有未使用的导入
- ✅ **代码模块化**：
  - 提取了 `ImportConfirmDialog`、`ImportResultDialog`、`ExportOptionsDialog`、`DateRangePickerDialog`、`ExportConfirmDialog` 五个对话框组件
  - 提升了代码可读性和可维护性
  - 实现了功能的无损切换

### 2. 导入导出功能完善（已完成）
- ✅ **导出功能**：
  - 支持三种导出模式：当前日期、自定义日期范围、所有日程
  - 导出选项对话框，显示每个选项的日程数量
  - 日期范围选择对话框，支持箭头按钮调整日期，实时显示范围内的日程数量
  - 导出确认对话框，显示日程数量和文件名
  - 完善的错误处理和友好的用户提示
- ✅ **导入功能**：
  - 导入确认对话框，显示日程预览（前5个日程）和冲突处理选项（覆盖/跳过）
  - 导入结果对话框，卡片式统计信息展示（成功/跳过/失败）
  - 完善的错误处理，提供具体的错误说明和建议
- ✅ **UI/UX 优化**：
  - 人性化文案（使用"日程"而非技术术语）
  - 友好的空数据提示
  - 清晰的错误信息展示
  - 隐藏技术细节（如 UID、ICS 文本内容），只显示用户关心的信息

## 📋 待完善功能（可选功能）

### 1. 固定时间提醒（低优先级）
- **当前状态**：当前只支持提前提醒，不支持固定时间提醒
- **需要完善**：
  - 在 `EventEditorDialog` 中添加"固定时间提醒"选项
  - 扩展 `Reminder` 实体，支持固定时间提醒类型
  - 在 `EventRepository` 中处理固定时间提醒逻辑

### 2. 农历转公历功能（中优先级）
- **当前状态**：已使用第三方库 `io.github.xhinliang:lunarcalendar` 实现公历转农历，但未实现农历转公历
- **需要完善**：
  - 实现农历转公历功能（可使用第三方库或自行实现算法）
  - 支持闰月处理
  - 用于实现"按农历日期创建事件"功能

### 3. 按农历创建事件（低优先级）
- **当前状态**：未实现，所有事件都按公历日期创建
- **需要完善**：
  - 在 `EventEditorDialog.kt` 中添加"按农历日期"选项（单选按钮：公历/农历）
  - 实现农历日期选择器（年、月、日、是否闰月）
  - 将农历日期转换为公历日期进行存储（需要先实现农历转公历功能）
  - 支持农历重复事件（如每年农历生日，需要计算每年的对应公历日期）
  - 在事件详情中显示"按农历日期创建"标记

### 4. 快速订阅按钮（低优先级）
- **当前状态**：订阅事件卡片中未添加快速订阅/取消订阅按钮
- **需要完善**：
  - 在订阅事件卡片中添加快速订阅/取消订阅按钮
  - 优化订阅管理流程，提升用户体验

### 5. 错误处理和测试（中优先级）
- **当前状态**：基础错误处理已实现
- **需要完善**：
  - 完善网络请求错误处理（网络超时、API 错误等）
  - 添加单元测试
  - 优化错误提示的用户体验
