# 日历应用扩展功能开发 TODO

## 📋 项目总览与实现情况评估

### 基本要求实现情况

#### ✅ 1. 日历视图展示（月视图、周视图、日视图）
- **实现状态**：✅ **已完成**
- **实现细节**：
  - 月视图（MonthView）：完整实现，支持日期选择、事件标记、农历显示、节日节气显示
  - 周视图（WeekView）：完整实现，支持周导航、事件标记、农历显示
  - 日视图（DayView）：完整实现，显示当日所有事件和订阅事件，包含完整农历信息卡片
  - 视图切换：支持平滑动画切换（AnimatedContent）
  - 导航功能：支持上一月/周/日、下一月/周/日、快速跳转到今天

#### ✅ 2. 日程添加、编辑、查看和删除
- **实现状态**：✅ **已完成**
- **实现细节**：
  - ✅ 添加日程：通过 FloatingActionButton 打开 EventEditorDialog，采用模块化设计
  - ✅ 编辑日程：点击日程卡片打开编辑对话框，支持修改所有字段
  - ✅ 查看日程：在月/周/日视图中显示日程，点击查看详情
  - ✅ 删除日程：在编辑对话框中提供删除按钮，删除时同步清理提醒记录
  - ✅ 数据模型：完全符合 RFC5545 标准（UID、SUMMARY、DESCRIPTION、DTSTART、DTEND、LOCATION等）
  - ✅ **日程类型选择**：支持选择"普通日程"、"生日"、"纪念日"、"其他"四种类型，已持久化到数据库
  - ✅ **时间选择器**：使用 Material3 TimePicker，精确到分钟
  - ✅ **重复次数选择**：支持选择"仅一次"、"每天"、"每周"、"每月"，后端已实现重复事件生成逻辑
  - ✅ **响铃提醒开关**：支持响铃提醒开关控制，后端已实现响铃控制逻辑
  - ✅ **日程状态样式优化**：
    - 已完成状态：灰色竖线、浅灰背景、灰色文字、灰色边框，显示"已完成"标签
    - 正在进行中：橙色竖线（5dp，更粗）、橙色浅背景、深橙色文字、橙色边框、更高阴影（4dp），显示"进行中"标签
    - 未完成状态：蓝色竖线、蓝色浅背景、深蓝色文字、蓝色边框，显示"待办"标签
    - 所有状态都显示状态标签，添加边框以增强区分度，优化颜色对比度

#### ✅ 3. 日程提醒功能
- **实现状态**：✅ **已完成**
- **实现细节**：
  - ✅ 提醒方式：支持提前提醒（5/15/30/60分钟），默认5分钟提醒
  - ✅ 提醒调度：使用 AlarmManager 和 BroadcastReceiver 实现系统级提醒
  - ✅ 提醒通知：通过 NotificationManager 发送通知，包含日程标题
  - ✅ 提醒管理：创建/更新/删除日程时自动管理提醒，保证数据一致性
  - ✅ 提醒存储：使用 Reminder 实体存储提醒记录
  - ✅ **响铃提醒**：已完全实现，响铃时包含声音、震动和灯光，不响铃时仅显示灯光
- **待完善部分**：
  - ⚠️ **固定时间提醒**：当前未实现，代码中只有提前提醒功能（可选功能）

### 扩展要求实现情况

#### ✅ 1. 日历事件的导入导出
- **实现状态**：✅ **已完成**
- **实现细节**：
  - 导入功能：支持从 .ics 文件导入，完全符合 RFC5545 标准
    - 解析 VEVENT 组件（UID、DTSTART、DTEND、SUMMARY、DESCRIPTION、LOCATION等）
    - 处理时区转换（UTC 到本地时区）
    - 处理文本字段转义字符
    - UID 冲突检测（支持覆盖或跳过策略）
    - 导入结果反馈（成功/跳过/错误统计）
  - 导出功能：支持导出为 .ics 格式
    - 导出当前选中日期的事件
    - 导出指定日期范围的事件
    - 导出所有事件
    - 支持保存到文件和复制到剪贴板

#### ✅ 2. 网络订阅功能
- **实现状态**：✅ **已完成**
- **实现细节**：
  - ✅ 数据模型：Subscription 和 SubscriptionEvent 实体，支持天气和黄历两种类型
  - ✅ 网络服务层：Retrofit + OkHttp + Gson，已配置真实 API（天气：http://t.weather.itboy.net/，黄历：http://v.juhe.cn/）
  - ✅ 订阅管理 UI：SubscriptionScreen 支持添加、编辑、删除、启用/禁用订阅
  - ✅ 订阅事件展示：SubscriptionEventItem 支持天气和黄历两种卡片样式
  - ✅ 数据同步：支持手动同步和 WorkManager 定时自动同步（每24小时执行一次）
- **待完善部分**（可选功能）：
  - ⚠️ **15日天气预报展开**：UI 中预留了位置但未实现展开/收起功能
  - ⚠️ **快速订阅按钮**：订阅事件卡片中未添加快速订阅/取消订阅按钮

#### ✅ 3. 农历相关功能
- **实现状态**：✅ **核心功能已完成**
- **实现细节**：
  - ✅ 农历计算：使用第三方库 `io.github.xhinliang:lunarcalendar` 实现公历转农历
  - ✅ 天干地支计算：支持年、月、日的天干地支计算
  - ✅ 生肖计算：根据年份计算生肖
  - ✅ 节气判断：使用库提供的节气信息
  - ✅ 节日判断：支持农历节日和公历节日
  - ✅ 农历显示：在月/周/日视图中完整显示农历信息（农历日期、天干地支、生肖、节气、节日等）
- **待完善部分**（可选扩展功能）：
  - ⚠️ **农历转公历**：未实现农历日期转公历日期功能
  - ⚠️ **按农历创建事件**：未实现按农历日期创建事件的功能
  - ⚠️ **农历重复事件**：未支持农历重复事件（如每年农历生日）


## 需要完善的内容

### 待完善功能（可选功能）

#### 1. 固定时间提醒（低优先级）
- **当前状态**：当前只支持提前提醒，不支持固定时间提醒
- **需要完善**：
  - 在 `EventEditorDialog` 中添加"固定时间提醒"选项
  - 扩展 `Reminder` 实体，支持固定时间提醒类型
  - 在 `EventRepository` 中处理固定时间提醒逻辑

#### 2. 农历转公历功能（中优先级）
- **当前状态**：已使用第三方库 `io.github.xhinliang:lunarcalendar` 实现公历转农历，但未实现农历转公历
- **需要完善**：
  - 实现农历转公历功能（可使用第三方库或自行实现算法）
  - 支持闰月处理
  - 用于实现"按农历日期创建事件"功能


#### 5. 订阅事件展示优化（已完成）✅
- **实现状态**：✅ **已完成**
- **实现细节**：
  - ✅ **天气卡片样式优化**：
    - 顶部左侧图标从 ☀️ 更换为 🌤️，使用蓝色背景（Color(0xFF64B5F6)）
    - 图标尺寸从 24dp 调整为 28dp，圆角从 4dp 调整为 6dp
    - "天气"文字使用 titleMedium 样式，加粗显示
  - ✅ **城市切换功能**：
    - 所有天气卡片都显示城市切换按钮（不再仅限于当天）
    - 切换按钮采用胶囊形状设计，包含位置图标、城市名称和切换图标
    - 使用浅蓝色背景和圆角设计，提升视觉识别度
  - ✅ **城市选择对话框优化**：
    - 添加搜索框功能，支持实时过滤城市列表（不区分大小写）
    - 优化对话框样式，使用卡片式设计展示城市列表
    - 选中城市高亮显示（蓝色背景和文字）
    - 固定对话框高度 400dp，避免过长
    - 空状态时显示友好提示信息
- **待完善部分**（可选功能）：
  - ⚠️ **15日天气预报展开功能**：UI 中预留了位置但未实现展开/收起功能
  - ⚠️ **快速订阅按钮**：订阅事件卡片中未添加快速订阅/取消订阅按钮

#### 6. 农历事件创建（低优先级）⚠️
- **当前状态**：未实现，所有事件都按公历日期创建
- **需要完善**：
  - 在 `EventEditorDialog.kt` 中添加"按农历日期"选项（单选按钮：公历/农历）
  - 实现农历日期选择器（年、月、日、是否闰月）
  - 将农历日期转换为公历日期进行存储（需要先实现农历转公历功能）
  - 支持农历重复事件（如每年农历生日，需要计算每年的对应公历日期）
  - 在事件详情中显示"按农历日期创建"标记

#### 7. 错误处理和测试（中优先级）
- **当前状态**：基础错误处理已实现
- **需要完善**：
  - 完善网络请求错误处理（网络超时、API 错误等）
  - 添加单元测试
  - 优化错误提示的用户体验
